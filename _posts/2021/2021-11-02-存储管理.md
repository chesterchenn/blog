---
layout: post
tags: 2021 os
title: 存储管理
---

存储器管理的对象是主存，也称内存。

## 分页存储管理

- 页：将一个进程的地址空间划分若干个大小相等的区域。
- 块或页框：将主存空间划分成与页相同大小的若干个物理块。
- 分页存储：在为进程分配主存时，将进程中若干页分别装入多个不相邻接的块中。
- 页表：系统为每个进程建立一张页面的映射表。

分页的地址结构：由两部分组成，前一部分为页号 P，后一部分为偏移量 W，即页内地址。

```plain
+------------------+
| 页号P | 页内地址W  |
+------------------+

A 表示逻辑地址
L 表示页面大小，页取值 B
P = INT(A/L) INT 表示取整
W = MOD(A/L) MOD 表示去余
物理地址 = 页号框 * 页面大小 + 页内偏移地址
```

从地址映射的过程中可以发现，页式存储管理至少需要两次访问主存。例如，第一次是访问页表，得到的是数据的物理地址，第二次是存取数据。

快表：在地址映射机构中增加一个小容量的联想存储器，联想存储器由一组高速存储器组成，称之为快表。用来保存当前访问频率高的少数活动页的页号及相关信息。

## 分段存储管理

在分段存储管理方式中，作业的地址空间被划分为若干个段，每个段是一组完整的逻辑信息。

例如有主程序段、子程序段、数据段和堆栈段等，每个段都有自己的名字，都是从 0 开始编址的一段连续的地址空间，各段的长度是不等的。

分段系统的地址结构有段号 s 和段内地址 d 两部分组成。

```plain
+-------------------+
| 段号 s | 段内地址 d |
+-------------------+
```

段表是系统为每个进程建立一张段映射表，段标由段表项构成，每个段表项包括段号、段基址（起始地址）和段长（段大小）。

## 页面置换算法

请求分页是在纯分页系统的基础上增加了请求调页功能、页面置换功能所形成的页式虚拟存储系统，它是目前常用的一种虚拟存储器的方式。

在进程运行过程中，如果发生缺页，此时主存中又无空闲块时，为了保证进程能正常运行，必须从主存中调出一页程序或数据送磁盘的对换区。需要根据一定的页面置换算法来确定。

抖动：即刚被换出的页很快又被访问，需重新调入，导致系统频繁地更换页面，以至于一个进程在运行中把大部分时间花费在完成页面置换的工作上。不合适的页面置换算法会导致系统发生抖动。

1. 最佳（Optimal）置换算法

   这是一种理想化的算法，即选择那些是永不使用的，或者是在最长时间内不再被访问的页面置换出去。这种方法性能最好，但实际上难于实现，所以该算法通常用来评价其他算法。

2. 先进先出（FIFO）置换算法

   该算法总是淘汰最先进入主存的页面，即选择在主存中驻留时间最久的页面淘汰。该算法实现简单，只需把一个进程调入主存的页面，按先后次序链接成一个队列，并设置一个指针即可。

   它是一种最直观、性能最差的算法，有 Belady 异常现象，是指如果一个进程未分配它所要求的的全部页面，有时就会出现分配的页面数增加但缺页率反而提高的异常现象。

3. 最近最少使用（Least Recently Used, LRU）置换算法

   该算法是选择最近最少未使用的页面予以淘汰，系统在每个页面设置一个访问字段，用于记录这个页面自上次被访问以来所经历的时间 T，当要淘汰一个页面时，选择 T 最大的页面，但在实现时需要硬件的支持（寄存器或栈）。

4. 最近未用（Not Used Recently, NUR）置换算法

   NUR 算法将最近一段时间位引用过的页面置换出，这是一种 LRU 的近似算法。

   该算法为每个页面设置一位访问位，将主存中的所有页面都通过链接指针链成一个循环队列。当某页被访问时，其访问位置1。在选择一页淘汰时，检查其访问位，如果是 0，则选择该页换出；若是 1，则重新置为 0，暂不换出该页，在循环队列中检查下一个页面，知道访问位为 0 的页面为止。

## 参考链接

- 《软件设计师教程》
- [操作系统原理之内存管理(第四章第二部分)](https://www.cnblogs.com/jalja/p/11455440.html)
